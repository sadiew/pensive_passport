{% extends 'base.html' %}

{% block body %}
<h1>{{ city }}, {{country}}</h1>

<div class="row">   
  <div class="col-md-6" id="map-canvas" style="width:500px; height:200px"></div>
  <div class="col-md-6" id="similar-trips"></div>
</div>
<div class="row">
  <button id="get-places-button" class="btn btn-primary">City Highlights</button>
</div>
<div class="row">
  <div class="col-md-4">
      <div id="restaurant-info"></div>
  </div>
  <div class="col-md-4">
      <div id="museum-info"></div>
  </div>
  <div class="col-md-4">
      <div id="park-info"></div>
  </div>
</div>
</div>



<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>

<script>

    var geocoder;
    var map;
    var winning_city = '{{city}}' + ', ' + '{{country}}';

    function initialize(location) {
      geocoder = new google.maps.Geocoder();
      geocoder.geocode( { 'address': location}, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          map.setCenter(results[0].geometry.location);
          var marker = new google.maps.Marker({
              map: map,
              position: results[0].geometry.location
          });
        } else {
          alert('Geocode was not successful for the following reason: ' + status);
        }
      });
      
      var mapOptions = {
        zoom: 12,

      }
      map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    }

    function getMap() {
      initialize(winning_city);
    }

    function createMarker(place) {
        place.style.color= "black";
      var latLon = (place.getAttribute("data-lat-lon")).split(", ");
      var lat = latLon[0];
      var lon = latLon[1];

      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(lat, lon),
        map: map
        });

    }
    
    function getPlaces(evt) {
        $('#get-places-button').hide();
        
        $.post( "/get-restaurants",
            { city: '{{city}}', country: '{{country}}', city_id: '{{city_id}}'},
            function (result) {
                $('#restaurant-info').append("<h3>Restaurants</h3>");
                for (item in result) {
                    var latLon = result[item].lat + ', ' + result[item].lng;                    
                    $('#restaurant-info').append("<p><a href='#' onclick='createMarker(this)' data-lat-lon='" + latLon + "'>" + item + "</a></p>");
                    };
                }
        );

        $.post( "/get-museums",
            { city: '{{city}}', country: '{{country}}'},
            function (result) { 
            $('#museum-info').append("<h3>Museums</h3>");
                for (item in result) {
                    var latLon = result[item].lat + ', ' + result[item].lng
                    $('#museum-info').append("<p><a href='#' onclick='createMarker(this)' data-lat-lon='" + latLon + "'>" + item + "</a></p>");
                };
            }
        );

        $.post( "/get-parks",
            { city: '{{city}}', country: '{{country}}'},
            function (result) { 
            $('#park-info').append("<h3>Parks</h3>");
                for (item in result) {
                    var latLon = result[item].lat + ', ' + result[item].lng
                    $('#park-info').append("<p><a href='#' onclick='createMarker(this)' data-lat-lon='" + latLon + "'>" + item + "</a></p>");
                };
            }
        );

        $.get( "/get-similar-trips?city_id='{{city_id}}'",
            function (result) {
                $('#similar-trips').append("<h4>Users with similar travel interests also searched:</h4>"); 
                for (item in result) {
                    $('#similar-trips').append("<p><a href='/cities/" + item + "'>" + result[item] + "</a></p>");
                };
            }
        );


    };

    google.maps.event.addDomListener(window, 'load', getMap);
    $('#get-places-button').on('click', getPlaces);
</script>

{% endblock %}